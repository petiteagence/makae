
- var resolveImageSrc = function(src){
- 	return (src.toLowerCase().indexOf('http') > -1) ? src : 'img/'+src;
- }

- var markup = function(text){
- 	text = text.replace(/\[saut\]/, '<br>');
- 	text = text.replace(/\[gras\|([^\]]*)\]/, '<strong>$1</strong>');
- 	text = text.replace(/\[petit\|([^\]]*)\]/, '<small>$1</small>');
- 	text = text.replace(/\[lien\|([^\|]*)\|([^\]]*)\]/, '<a href="$2">$1</a>');
- 	text = text.replace(/\[ancre\|([^\|]*)\|([^\]]*)\]/, '<a href="#$2">$1</a>');
- 	return text
- }

mixin img(src,alt,lien)
	if lien
		a.image(href=lien)
			img(src=resolveImageSrc(src), alt=alt, title=alt)
	else
		span.image
			img(src=resolveImageSrc(src), alt=alt, title=alt)

	

mixin render(bloc)
	+#{'render_'+bloc.type}(bloc)

mixin render_titre(bloc)
	.bloc(class='bloc_'+bloc.type)
		h3.item!= markup(bloc.contenu)

mixin render_image(bloc)
	.bloc(class='bloc_'+bloc.type)
		figure.item
			+img(bloc.imageUrl, bloc.imageAlt, bloc.imageLien)
			if bloc.imageLegende
				figcaption!= markup(bloc.imageLegende)

mixin render_textes(bloc)
	.bloc(class='bloc_'+bloc.type)
		for i in bloc.items
			if i.lien
				a.item(href=i.lien)
					+render_blocItem(i)
			else
				.item
					+render_blocItem(i)


mixin render_blocItem(i)
	if i.liste
		ul.liste
			for li in i.liste
				li!= markup(li)
	else
		div.texte(class=i.imagePosition||'dessus')
			if i.gras
				strong!= markup(i.gras)
			- if(i.imageUrl && i.imagePosition != "dessous")
				+img(i.imageUrl, i.imageAlt, i.imageLien)
			if i.texte
				p!= markup(i.texte)
			- if(i.imageUrl && i.imagePosition == "dessous")
				+img(i.imageUrl, i.imageAlt, i.imageLien)


mixin render_box3D(bloc)
	.bloc(class='bloc_'+bloc.type)
		ul.boxes
			for i in bloc.items
				li.w_box
					a.box(class='box_'+i.boxColor, href='#'+i.lien)
						.box_img
							+img(i.imageUrl, i.imageAlt)
						.box_info
							p!= markup(i.texte)





doctype html
html(lang="fr")
	include jade/head

body

	div.page

		header.section.section-header
			.layer_bg(style="background-image: url(img/"+header.image+")")
			.layer_fg
				include jade/header
				//- include jade/nav
			
		
		for section in sections
			section.section(class='theme_'+section.theme)
				a(name=section.id)
				.section_maxwidth
					for bloc in section.blocs
						+render(bloc)


		footer.section.section-footert
			.bloc
				p.item Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aspernatur voluptatibus minima, eaque ut voluptatum, possimus iure vel! Ex omnis vitae sint, molestiae animi asperiores impedit, voluptatum architecto optio enim eligendi.
